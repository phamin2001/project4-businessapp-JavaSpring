
<html>
<head>
  <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
  <link rel="stylesheet" href="/css/nodedocs.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="/css/highlight/github.css" type="text/css" media="screen" title="no title" charset="utf-8">
</head>
<body>
  <header>
    <div class="link"><a href="http://github.com/nodejitsu/docs">Edit this page on GitHub</a></div>
    <div class="title">docs.nodejitsu.com</div>
  </header>

  <div id="mask"></div>
  <div id="toc"><ul><li><a href="/articles/advanced">advanced</a><ul><li><a href="/articles/advanced/buffers">buffers</a><ul><li><a href="/articles/advanced/buffers/how-to-use-buffers">how to use buffers</a></li></ul></li><li><a href="/articles/advanced/streams">streams</a><ul><li><a href="/articles/advanced/streams/how-to-use-fs-create-read-stream">how to use fs create read stream</a></li><li><a href="/articles/advanced/streams/how-to-use-fs-create-write-stream">how to use fs create write stream</a></li><li><a href="/articles/advanced/streams/how-to-use-stream-pipe">how to use stream pipe</a></li><li><a href="/articles/advanced/streams/what-are-streams">what are streams</a></li></ul></li></ul></li><li><a href="/articles/child-processes">child processes</a><ul><li><a href="/articles/child-processes/how-to-spawn-a-child-process">how to spawn a child process</a></li></ul></li><li><a href="/articles/command-line">command line</a><ul><li><a href="/articles/command-line/how-to-get-colors-on-the-command-line">how to get colors on the command line</a></li><li><a href="/articles/command-line/how-to-parse-command-line-arguments">how to parse command line arguments</a></li><li><a href="/articles/command-line/how-to-prompt-for-command-line-input">how to prompt for command line input</a></li></ul></li><li><a href="/articles/cryptography">cryptography</a><ul><li><a href="/articles/cryptography/how-to-use-crypto-module">how to use crypto module</a></li><li><a href="/articles/cryptography/how-to-use-the-tls-module">how to use the tls module</a></li></ul></li><li><a href="/articles/errors">errors</a><ul><li><a href="/articles/errors/what-are-the-error-conventions">what are the error conventions</a></li><li><a href="/articles/errors/what-is-the-error-object">what is the error object</a></li><li><a href="/articles/errors/what-is-try-catch">what is try catch</a></li></ul></li><li><a href="/articles/file-system">file system</a><ul><li><a href="/articles/file-system/how-to-read-files-in-nodejs">how to read files in nodejs</a></li><li><a href="/articles/file-system/how-to-search-files-and-directories-in-nodejs">how to search files and directories in nodejs</a></li><li><a href="/articles/file-system/how-to-store-local-config-data">how to store local config data</a></li><li><a href="/articles/file-system/how-to-use-the-path-module">how to use the path module</a></li><li><a href="/articles/file-system/how-to-write-files-in-nodejs">how to write files in nodejs</a></li></ul></li><li><a href="/articles/getting-started">getting started</a><ul><li><a href="/articles/getting-started/control-flow">control flow</a><ul><li><a href="/articles/getting-started/control-flow/how-to-write-asynchronous-code">how to write asynchronous code</a></li><li><a href="/articles/getting-started/control-flow/what-are-callbacks">what are callbacks</a></li><li><a href="/articles/getting-started/control-flow/what-are-event-emitters">what are event emitters</a></li></ul></li><li><a href="/articles/getting-started/globals-in-node-js">globals in node js</a></li><li><a href="/articles/getting-started/how-to-debug-nodejs-applications">how to debug nodejs applications</a></li><li><a href="/articles/getting-started/how-to-use-util-inspect">how to use util inspect</a></li><li><a href="/articles/getting-started/npm">npm</a><ul><li><a href="/articles/getting-started/npm/how-to-access-module-package-info">how to access module package info</a></li><li><a href="/articles/getting-started/npm/what-is-npm">what is npm</a></li><li><a href="/articles/getting-started/npm/what-is-the-file-package-json">what is the file package json</a></li></ul></li><li><a href="/articles/getting-started/the-console-module">the console module</a></li><li><a href="/articles/getting-started/the-process-module">the process module</a></li><li><a href="/articles/getting-started/what-is-require">what is require</a></li></ul></li><li><a href="/articles/HTTP">HTTP</a><ul><li><a href="/articles/HTTP/clients">clients</a><ul><li><a href="/articles/HTTP/clients/how-to-access-query-string-parameters">how to access query string parameters</a></li><li><a href="/articles/HTTP/clients/how-to-create-a-HTTP-request">how to create a HTTP request</a></li></ul></li><li><a href="/articles/HTTP/servers">servers</a><ul><li><a href="/articles/HTTP/servers/how-to-create-a-HTTP-server">how to create a HTTP server</a></li><li><a href="/articles/HTTP/servers/how-to-create-a-HTTPS-server">how to create a HTTPS server</a></li><li><a href="/articles/HTTP/servers/how-to-read-POST-data">how to read POST data</a></li><li><a href="/articles/HTTP/servers/how-to-serve-static-files">how to serve static files</a></li></ul></li></ul></li><li><a href="/articles/javascript-conventions">javascript conventions</a><ul><li><a href="/articles/javascript-conventions/how-to-create-default-parameters-for-functions">how to create default parameters for functions</a></li><li><a href="/articles/javascript-conventions/what-are-the-built-in-timer-functions">what are the built in timer functions</a></li><li><a href="/articles/javascript-conventions/what-are-truthy-and-falsy-values">what are truthy and falsy values</a></li><li><a href="/articles/javascript-conventions/what-is-json">what is json</a></li><li><a href="/articles/javascript-conventions/what-is-the-arguments-object">what is the arguments object</a></li></ul></li><li><a href="/articles/REPL">REPL</a><ul><li><a href="/articles/REPL/how-to-create-a-custom-repl">how to create a custom repl</a></li><li><a href="/articles/REPL/how-to-use-nodejs-repl">how to use nodejs repl</a></li></ul></li></ul></div>
  <div id="article">
    <div id="metadata">
      <h1 class="title">How to serve static files</h1>
      <div class="date">Fri Aug 26 2011 03:08:50 GMT-0700 (PST)</div>
      <div class="author">nico</div>
      <div>
        
      <a href="/articles" class="breadcrumb">articles</a><a href="/articles/HTTP" class="breadcrumb">HTTP</a><a href="/articles/HTTP/servers" class="breadcrumb">servers</a><a href="/articles/HTTP/servers/how-to-serve-static-files" class="breadcrumb">how-to-serve-static-files</a></div>
      <!--
        <div class="tags"></div>
        <div class="difficulty"></div>
      -->
    </div>
    <div id="content"><p>A basic necessity for most <a href="/how-do-i-create-a-https-server">http servers</a> is to be able to serve static files. Thankfully, it is not that hard to do in Node.js. First you [link]read the file, then you serve the file.  Here is an example of a script that will serve the files in the current directory:</p>

<pre><code><span class="keyword">var</span> fs = require(<span class="string">'fs'</span>),
    http = require(<span class="string">'http'</span>);

http.createServer(<span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> {</span>
  fs.readFile(__dirname + req.url, <span class="function"><span class="keyword">function</span> <span class="params">(err,data)</span> {</span>
    <span class="keyword">if</span> (err) {
      res.writeHead(<span class="number">404</span>);
      res.end(JSON.stringify(err));
      <span class="keyword">return</span>;
    }
    res.writeHead(<span class="number">200</span>);
    res.end(data);
  });
}).listen(<span class="number">8080</span>);</code></pre>

<p>This example takes the path requested and it serves that path, relative to the local directory. This works fine as a quick solution; however, there are a few problems with this approach. First, this code does not correctly handle mime types. Additionally, a proper static file server should really be taking advantage of client side caching, and should send a &quot;Not Modified&quot; response if nothing has changed.  Furthermore, there are security bugs that can enable a malicious user to break out of the current directory. (for example, <code>GET /..<span class="regexp">/../</span>../</code>). </p>

<p>Each of these can be addressed invidually without much difficulty. You can send the proper mime type header. You can figure how to utilize the client caches. You can take advantage of <code>path.normalize</code> to make sure that requests don't break out of the current directory. But why write all that code when you can just use someone else's library? </p>

<p>There is a good static file server called <a href="https://github.com/cloudhead/node-static">node-static</a> written by Alexis Sellier which you can leverage. Here is a script which functions similarly to the previous one:</p>

<pre><code><span class="keyword">var</span> static = require(<span class="string">'node-static'</span>);
<span class="keyword">var</span> http = require(<span class="string">'http'</span>);

<span class="keyword">var</span> file = <span class="keyword">new</span>(static.Server)();

http.createServer(<span class="function"><span class="keyword">function</span> <span class="params">(req, res)</span> {</span>
  file.serve(req, res);
}).listen(<span class="number">8080</span>);</code></pre>

<p>This is a fully functional file server that doesn't have any of the bugs previously mentioned. This is just the most basic set up, there are more things you can do if you look at <a href="https://github.com/cloudhead/node-static">the api</a>. Also since it is an open source project, you can always modify it to your needs (and feel free to contribute back to the project!).</p></div>
  </div>
  <script type="text/javascript" charset="utf-8" src="/js/jquery.js"></script>
  <script type="text/javascript" charset="utf-8" src="/js/index.js"></script>
  <script type="text/javascript">
  var _sf_async_config={uid:11119,domain:"docs.nodejitsu.com"};
  (function(){
    function loadChartbeat() {
      window._sf_endpt=(new Date()).getTime();
      var e = document.createElement('script');
      e.setAttribute('language', 'javascript');
      e.setAttribute('type', 'text/javascript');
      e.setAttribute('src',
         (("https:" == document.location.protocol) ? "https://a248.e.akamai.net/chartbeat.download.akamai.com/102508/" : "http://static.chartbeat.com/") +
         "js/chartbeat.js");
      document.body.appendChild(e);
    }
    var oldonload = window.onload;
    window.onload = (typeof window.onload != 'function') ?
       loadChartbeat : function() { oldonload(); loadChartbeat(); };
  })();
  </script>
</body>
</html>